<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Quiz Runner</title>
  <style>
    /* Same styles as before */
  </style>
</head>
<body>
  <div id="question-box" style="display: none;">
    <h3 id="question-text"></h3>
    <div id="options"></div>
  </div>

  <div id="scoreboard">
    <div>Score: <span id="score">0</span></div>
    <div>Lives: <span id="lives">3</span></div>
    <div>High Score: <span id="highscore">0</span></div>
  </div>

  <canvas id="gameCanvas" width="800" height="400"></canvas>

  <div id="game-over-box">
    <h2 id="game-over-message"></h2>
    <button class="btn" onclick="restartGame()">Race Again</button>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let score = 0;
    let lives = 3;
    let highscore = localStorage.getItem("quizRunnerHighscore") || 0;
    document.getElementById("highscore").textContent = highscore;

    const ground = 350;
    const gravity = 1.2;
    const jumpPower = -15;

    const player = {
      x: 50,
      y: ground - 40,
      width: 40,
      height: 40,
      vy: 0,
      jumping: false,
      hit: false,
      hitFrame: 0
    };

    let obstacles = [];
    let gameSpeed = 4;
    let questions = [
      { question: "Capital of France?", options: ["Paris", "London", "Berlin", "Rome"], answer: "Paris" },
      { question: "Red Planet?", options: ["Venus", "Earth", "Mars", "Jupiter"], answer: "Mars" },
      { question: "Largest mammal?", options: ["Elephant", "Shark", "Blue Whale", "Rhino"], answer: "Blue Whale" },
      { question: "HTML means?", options: ["HyperText Markup Language", "Code", "Structure", "Format"], answer: "HyperText Markup Language" },
      { question: "Continents?", options: ["5", "6", "7", "8"], answer: "7" },
      { question: "Deepest ocean?", options: ["Indian", "Pacific", "Arctic", "Atlantic"], answer: "Pacific" },
      { question: "Photosynthesis gas?", options: ["Oxygen", "Carbon Dioxide", "Nitrogen", "Hydrogen"], answer: "Carbon Dioxide" },
      { question: "√64?", options: ["6", "8", "7", "9"], answer: "8" },
      { question: "WW2 End Year?", options: ["1945", "1940", "1939", "1950"], answer: "1945" },
      { question: "Boiling point of water?", options: ["100°C", "90°C", "80°C", "110°C"], answer: "100°C" }
    ];

    let usedQuestions = [];
    let currentQuestion = null;
    let awaitingAnswer = false;
    let currentObstacle = null;
    let correctAnswerGiven = false;
    let gameRunning = true;

    // Draw the player character
    function drawPlayer() {
      if (player.hit && player.hitFrame < 10) {
        ctx.fillStyle = player.hitFrame % 2 === 0 ? "#ff0000" : "#ffaaaa";
        player.hitFrame++;
      } else {
        player.hit = false;
        player.hitFrame = 0;
        ctx.fillStyle = "red";
      }
      ctx.fillRect(player.x, player.y, player.width, player.height);
    }

    // Draw obstacles
    function drawObstacles() {
      ctx.fillStyle = "green";
      obstacles.forEach(ob => {
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
      });
    }

    // Function to spawn a new question with an obstacle
    function spawnQuestionWithObstacle() {
      if (awaitingAnswer || !gameRunning || questions.length === 0) return;

      const index = Math.floor(Math.random() * questions.length);
      currentQuestion = questions.splice(index, 1)[0];
      usedQuestions.push(currentQuestion); // Add question to usedQuestions

      const ob = { x: canvas.width, y: ground, width: 40, height: 50, id: Date.now() };
      obstacles.push(ob);
      currentObstacle = ob;
      awaitingAnswer = true;
      correctAnswerGiven = false;

      document.getElementById("question-box").style.display = "block";
      document.getElementById("question-text").textContent = currentQuestion.question;

      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";
      currentQuestion.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.className = "option";
        btn.onclick = () => handleAnswer(opt);
        optionsDiv.appendChild(btn);
      });

      setTimeout(() => {
        if (awaitingAnswer) {
          awaitingAnswer = false;
          document.getElementById("question-box").style.display = "none";
        }
      }, 10000);
    }

    setInterval(spawnQuestionWithObstacle, 7000);

    function handleAnswer(selected) {
      document.getElementById("question-box").style.display = "none";
      awaitingAnswer = false;
      if (selected === currentQuestion.answer) {
        correctAnswerGiven = true;
      } else {
        correctAnswerGiven = false;
      }
    }

    // Lose life and check for game over
    function loseLife(withAnimation = false) {
      lives--;
      document.getElementById("lives").textContent = lives;
      if (withAnimation) {
        player.hit = true;
        player.hitFrame = 0;
      }
      if (lives <= 0) {
        gameOver(false);
      }
    }

    // Game Over screen
    function gameOver(playerWon) {
      gameRunning = false;
      if (questions.length === 0 && lives > 0) {
        // Player answered all questions correctly and still has lives left
        document.getElementById("game-over-message").textContent = "Congratulations! You've completed the quiz!";
      } else {
        if (score > highscore) {
          localStorage.setItem("quizRunnerHighscore", score);
        }
        const message = playerWon ? "You are worthy to be a BlendRunner" : "Sorry your wheels fell off";
        document.getElementById("game-over-message").textContent = message;
      }
      document.getElementById("game-over-box").style.display = "block";
    }

    // Restart the game
    function restartGame() {
      score = 0;
      lives = 3;
      gameRunning = true;
      player.y = ground - player.height;
      player.jumping = false;
      obstacles = [];
      awaitingAnswer = false;
      currentObstacle = null;
      correctAnswerGiven = false;

      // Refill questions from usedQuestions
      if (questions.length === 0) {
        questions = [...usedQuestions];
        usedQuestions = [];
      }

      document.getElementById("score").textContent = score;
      document.getElementById("lives").textContent = lives;
      document.getElementById("game-over-box").style.display = "none";
    }

    // Game loop function
    function gameLoop() {
      if (!gameRunning) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);  // Clear canvas for next frame

      drawPlayer();
      drawObstacles();

      // Update obstacle positions
      obstacles.forEach(ob => {
        ob.x -= gameSpeed;
        if (ob.x + ob.width < 0) {
          obstacles = obstacles.filter(o => o.id !== ob.id);  // Remove obstacles that go off-screen
        }
      });

      requestAnimationFrame(gameLoop);  // Keep the game running by requesting another frame
    }

    gameLoop();  // Start the game loop

  </script>
</body>
</html>
